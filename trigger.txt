create function auto_buy() returns trigger as $$
	#variable_conflict use_column
	begin
		if new.quantity < 10 then
			update warehouse set quantity = quantity + (
			select sum(quantity)
			from orders
			where orders.appid = new.appid)
			where warehouse.appid = new.appid;
		end if;
		return new;
	end;
	$$ language plpgsql;
		


create trigger buy_from_publisher
	after update
	on warehouse
	for each row
	execute procedure auto_buy()
